<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru"><head><meta http-equiv="content-type" content="application/xhtml+xml; charset=utf-8" /><meta name="author" content="Dmitry Hrabrov a.k.a. DeXPeriX" /><link rel="stylesheet" type="text/css" href="../../images/npi.css" title="DeXPeriX Home Page" media="all"/><link rel="stylesheet" type="text/css" href="../../images/ki/articles.css" title="DeXPeriX Home Page additional" media="all" /><style type="text/css" media="all">@import "../../images/npi.css"; @import "../../images/ki/articles.css";</style><title>DeXPeriX Home Page : Статьи > Delphi > Создание градиентной заливки</title><link rel="alternate" title="DeXPeriX Home Page RSS" href="rss+ru.xml" type="application/rss+xml" /><script type="text/javascript" src="../../images/highlight/highlight.js"></script><script type="text/javascript">initHighlightingOnLoad('html', 'css', 'php', 'xml', 'delphi', 'cpp', 'sql', 'bash');</script></head><body><div id="header"><div id="top"><h1></h1><div id="translate"><ul id="lan"><li class="ru"><a href="gradient+npi+ru.html" title="ru"><img src="../../images/ki/ru.gif"></a></li><li id="ukazatel" class="clearer"></li><li></li></ul> </div><span>Linux, Hacking, Sources, News, Free Software, Photo and more...</span></div></div><div id="area"><ul id="menu"><li class="Новости"><a href="../../news/index+npi+ru.html" title="Новости"><img src="../../images/ki/home.jpg" alt="Новости" /></a></li><li><a href="../../blog/index+npi+ru.html" id="m1ru" title="Блог"></a></li><li><a href="../../articles/index+npi+ru.html" id="m2ru" title="Статьи"></a></li><li><a href="../../sources/index+npi+ru.html" id="m3ru" title="Исходники"></a></li><li><a href="../../soft/index+npi+ru.html" id="m4ru" title="Программы"></a></li><li><a href="../../projects/index+npi+ru.html" id="m5ru" title="Проекты"></a></li><li><a href="../../tranlations/index+npi+ru.html" id="m6ru" title="Переводы"></a></li><li><a href="../../photo/index+npi+ru.html" id="m7ru" title="Фотоальбом"></a></li><li id="search"><form id="form" action="http://www.google.com/cse" method="get" name="lse" class="lse"><input type="hidden" name="cx" value="015301063631066860216:x64p4f5z3o8" /><input type="hidden" name="ie" value="UTF-8" /><input class="text" type="text" name="q" value=""/><input class="sub" type="submit" value="" name="sa"></form></li></ul><div id="content"><div id="bg_right"><div id="topic"><div id="line"></div><h2>Создание градиентной заливки</h2> <div id="topic-list"><div id="contdata"><p>Вы, наверное, замечали, что в инсталляторах заливка формы не одноцветна, а плавно переходит от одного цвета к другому. Это выглядит довольно красиво. Почему бы не встроить в свою программу подобный переход? Но только переход от синего к чёрному устарел. Почему бы не залить свою форму другими цветами? Ниже приведён код, реализующий всё это. Его надо просто дописать в свой проект. Вызов процедуры GradientForm должен быть помещён в событие формы OnPaint.
<br />
<br />
<br />
<br />procedure TForm1.GradientForm (frm : TForm; startcolor, endcolor : TColor);
<br />// Горизонтальная градиентная заливка формы
<br />var
<br />startr : integer; // Стартовое количество красного цвета
<br />startg : integer; // Стартовое количество зелёного цвета
<br />startb : integer; // Стартовое количество синего цвета
<br />endr : integer; // Конечное количество красного цвета
<br />endg : integer; // Конечное количество зелёного цвета
<br />endb : integer; // Конечное количество синего цвета
<br />curr : integer; // Текущее количество красного цвета
<br />curg : integer; // Текущее количество зелёного цвета
<br />curb : integer; // Текущее количество синего цвета
<br />i : integer;
<br />r : TRect; // Прямоугольник, который будет заполняться различными цветами
<br />nolines: byte; // количество прямоугольников
<br />curpct : integer; // Текущий процент изменения окраски
<br />bitspix: longint; // биты в пикселе
<br />begin
<br />// конвертирует TColor в RGB
<br />startr := GetRValue(startcolor);
<br />startg := GetGValue(startcolor);
<br />startb := GetBValue(startcolor);
<br />endr := GetRValue(endcolor);
<br />endg := GetGValue(endcolor);
<br />endb := GetBValue(endcolor);
<br />
<br />// Считает количество прямоугольников (линий) с различными цветами
<br />if frm.Height < 250 then 
<br />nolines:=frm.Height
<br />else
<br />nolines:=250; // Максимум 250 прямоугольников (больше не нужно)
<br />bitspix:=GetDeviceCaps(frm.Canvas.Handle, BITSPIXEL); // Получает количество битов в пикселе
<br />if (bitspix = 8) and (nolines > 50) then // 256 цветов
<br />nolines:=50
<br />else if bitspix < 8 then // Меньше чем 256 цветов
<br />nolines:=4; // бедный парень! Это EGA монитор должен быть…
<br />
<br />r.Left:=0; // Left прямоугольника
<br />r.Right:=frm.Width; // Right прямоугольника
<br />
<br />for i:=0 to nolines do // Рисует градиент
<br />begin
<br />
<br />curpct:= (i * 100) div nolines; // % изменения (градиент)
<br />
<br />// Вычисляет количество красного для текущего прямоугольника
<br />if startr > endr then
<br />curr := startr - (curpct * (startr-endr) div 100)
<br />else
<br />curr := startr + (curpct * (endr-startr) div 100);
<br />
<br />// Вычисляет количество зелёного для текущего прямоугольника
<br />if startg > endg then
<br />curg := startg - (curpct * (startg-endg) div 100)
<br />else
<br />curg := startg + (curpct * (endg-startg) div 100);
<br />
<br />// Вычисляет количество синего для текущего прямоугольника
<br />if startb > endb then
<br />curb := startb - (curpct * (startb-endb) div 100)
<br />else
<br />curb := startb + (curpct * (endb-startb) div 100);
<br />
<br />// Устанавливает RGB цвет для текущего прямоугольника
<br />frm.Canvas.Brush.Color:=RGB(curr, curg, curb);
<br />
<br />// Высчитывает вершину и нижнюю точку прямоугольника (top и bottom)
<br />r.Top:=i + (i*(frm.Height div nolines));
<br />r.Bottom:=r.Top + (frm.Height div nolines)+1;
<br />
<br />// Рисует прямоугольник на холсте (на canvas)
<br />frm.Canvas.FillRect(r);
<br />end; // Конец цикла for
<br />end; // Конец процедуры GradientForm
<br />
<br />
<br />
<br />procedure TForm1.FormPaint(Sender: TObject);
<br />begin 
<br />// от светло-синего к чёрному - как в инсталляторах
<br />GradientForm(Form1,RGB(60,60,210), RGB(1,1,2));
<br />// Вместо RGB(60,60,210) и RGB(1,1,2) можно использовать свои цвета, включая цветовые константы Delphi типа clWhite, clBlack и т.д.
<br />end;
<br />
<br />
<br />
<br />
<br />Теперь рассмотрим пошагово, что здесь происходило.
<br />Начнём с самого начала:
<br />
<br />procedure TForm1.GradientForm (frm : TForm; startcolor, endcolor : TColor);
<br />Что передаётся в эту процедуру? Всё очень легко. Frm – та форма, которую нужно градиентно залить. StartColor и EndColor – цвета, которыми будет начинаться и кончаться заливка соответственно. Здесь ничего менять не надо – это просто заголовок. 
<br />Переменные откомментированы достаточно хорошо, так что переходим дальше. 
<br />Конвертация цветов. 
<br />Что такое цвет? На самом деле каждый цвет можно разложить на три составляющие: красную, зелёную, голубую. Это так называемый RGB: Red, Green, Blue. Для передачи RGB служат четырёх битные переменные. Почему? Да потому, что для каждого цвета выделено по одному байту. Почему тогда наша переменная не 3 байтная, ведь цветов всего три? - спросите вы. Дело в том, что в основе компьютера лежит двоичная система счисления. Т.е. всё должно быть кратным степеням двойки. Именно поэтому 4. Последний байт в обычных офисных приложениях чаще всего пустует. А в играх ему нашли применение – этот байт отвечает за прозрачность цвета. 
<br />Так вот, каждый бит – это 8 байт. Бит может принимать значение 0 , или 1. Следовательно байт может содержать два в восьмой степени различных комбинаций, т.е. 256 различных комбинаций. В шестнадцатеричной системе счисления ближайшее число FF. Из этого всего понятно, что цвет представляется в виде $00FFFFFF, где $ означает, что число представлено в шестнадцатеричной системе счисления остальные пары чисел обозначают цвета. Например $00FF0000 –синий цвет, $0000FF00 – зелёный цвет, $000000FF – красный.
<br />Дальше мы разбиваем цвет на его составляющие. Для этого есть такие стандартные процедуры: GetRValue – получить красную составляющую, GetGValue – получить зелёную составляющую, GetBValue – получить синюю (голубую) составляющую. 
<br />С цветом вроде бы как разобрались. Поехали дальше!
<br />Залить форму плавно изменяющимся цветом, конечно же не получиться. Но можно нарисовать много-много разноцветных маленьких прямоугольничков, которые создадут эффект плавного перехода цвета. Возникает проблема, сколько же нужно таких прямоугольничков? Больше 250 их не имеет смысла делать – заметно все равно не будет, а ресурсы будет «жрать» здорово. А если высота нашей формы меньше 250 пикселей, то тогда делать 250 прямоугольников бессмысленно. Тогда создадим количество прямоугольников, равное высоте нашей формы, т.е. у каждого горизонтального ряда пикселей будет свой уникальный цвет:
<br />
<br />if frm.Height < 250 then 
<br />nolines:=frm.Height
<br />else
<br />nolines:=250; // Максимум 250 прямоугольников (больше не нужно)
<br />
<br />Дальше идёт проверка количества цветов. Функция GetDeviceCaps возвращает количество цветов, поддерживаемых монитором. Например, цвет True Color соответствует 32 битам. На большинстве современных мониторов он поддерживается. Тогда имеет смысл рисовать до 250 прямоугольников – и у всех будет разный цвет. Если же у нас цвет только 8 битный, то больше 50 прямоугольников рисовать не имеет смысла. Если нарисовать больше, то рядом стоящие прямоугольники почти не будут отличаться:
<br />
<br />bitspix:=GetDeviceCaps(frm.Canvas.Handle, BITSPIXEL);
<br />if (bitspix = 8) and (nolines > 50) then 
<br />nolines:=50
<br />else if bitspix < 8 then 
<br />nolines:=4;
<br />
<br />Естественно, что наши прямоугольнички должны тянуться на всю ширину формы. Для этого достаточно их левую границу поставить в 0, а правой присвоить ширину формы:
<br />
<br />r.Left:=0; // Left прямоугольника
<br />r.Right:=frm.Width; // Right прямоугольника
<br />
<br />
<br />Теперь нам известно общее количество прямоугольников, их ширина. Теперь запустим цикл для рисования каждого из прямоугольников. Цвет прямоугольников будет отличаться. Причём на какой-то определённый процент. Этот процент можно рассчитать по формуле: 
<br />
<br />curpct:= (i * 100) div nolines;
<br />
<br />Выводится довольно просто: 100% - это у нас nolines (количество прямоугольников). Х – текущий процент, при линии i. Следовательно, Х будет равен i*100 и всё это разделить на общее количество линий.
<br />Известен процент изменения, как же посчитать текущий цвет? А вот так (на примере красной составляющей):
<br />
<br />if startr > endr then
<br />curr := startr - (curpct * (startr-endr) div 100)
<br />else
<br />curr := startr + (curpct * (endr-startr) div 100);
<br />
<br />Т.е. изменение цвета будет равно текущий процент умножить на общую разницу цветов и всё это разделить на 100%. Смысл условия if таков: если начальный цвет светлее конечного, то текущий цвет должен темнеть (например, белый $00FFFFFF больше чёрного $00000000). Иначе, если начальный темнее конечного, то текущий должен светлеть. Таким образом определяем каждую из составляющих текущего цвета.
<br />Теперь нам известны все составляющие текущего цвета, именно этим цветом мы сейчас и будем рисовать:
<br />
<br />frm.Canvas.Brush.Color:=RGB(curr, curg, curb);
<br />
<br />Нам всё известно, кроме верхней нижней точки прямоугольника. Найдём их:
<br />
<br />r.Top:=i + (i*(frm.Height div nolines));
<br />r.Bottom:=r.Top + (frm.Height div nolines)+1;
<br />
<br />Доказывается это аналогично проценту изменения цвета. (Если Вы в школе учили математику, то доказать это не составит Вам проблем J).
<br />Всё готово! Теперь можем рисовать прямоугольник:
<br />
<br />frm.Canvas.FillRect(r);
<br />
<br />Вот так работает данная программа.
<br />Как использовать это в своих целях? Да очень просто. Дописываете процедуру TForm1.GradientForm к своему проекту в нужный юнит, конечно, меняя TForm1 на название вашей формы. Не забудьте дописать эту процедуру в разделе описания типа формы. Потом создаёте для этой формы обработчик события OnPaint и в нём пишите:
<br />
<br />GradientForm(Form1,RGB(60,60,210), RGB(1,1,2));
<br />
<br />Вместо Form1 передавая название вашей формы. Можно передавать свои цвета. Немного поэкспериментировав можно найти вполне неплохие сочетания.</p></div><h2 id="comments">Комментарии</h2><div id="title"><h3><img src="../../images/flags/BY.gif" width="30" height="15" alt="BY" title="BY" /> DeXPeriX</h3><span>19.02.2006</span></div><div id="text"><img src="../../images/avatars/dexperix.jpg" class="preview" width="104" height="150" alt="DeXPeriX" title="DeXPeriX" /><p>Это моя самая первая статья, так что не судите строго! <img src="../../images/smilies/wink.png" align="top" height="20" width="20" alt="(wink)"/>Обновлять я её не буду - лучше напишу что-нибудь более полезное и новое, но и удалять не буду - пускай останется для истории <img src="../../images/smilies/smile.png" align="top" height="20" width="20" alt="(smile)"/></p></div><div id="next_comm">&nbsp;</div><div id="contdata"><h2 id="commentsform">Оставить комментарий</h2><form method="post" name="comment_form" id="comment_form" action="http://dexperix.net/scripts/comment.php"><table border="0"><tr><td><input type="hidden" name="id" value="15" /><input type="hidden" name="uid" value="23" />Имя (ник):</td><td><input type="text" name="nick" size="40" maxlength="35" /></td></tr><tr><td colspan="2"><small>( Ваш ник или реальное имя. Будет показано в заголовке комментария )</small></td></tr><tr><td>E-Mail:</td><td><input type="text" name="mail" size="40" maxlength="35" /></td></tr><tr><td colspan="2"><small>( Ваш e-mail. Используется только для связи с Вами администрации. Показан НЕ будет )</small></td></tr><tr><td>Сайт, ICQ или Jabber:</td><td><input type="text" name="site" size="40" maxlength="35" /></td></tr><tr><td colspan="2"><small>( Это поле будет отображено в заголовке комментария рядом с Вашим именем )</small></td></tr><tr><td>Ваша оценка:</td><td><select name="rathing" size="1"><option value="0" selected="selected">Нет оценки</option><option value="1">Ужасно</option><option value="2">Плохо</option><option value="3">Нормально</option><option value="4">Хорошо</option><option value="5">Отлично</option></select></td></tr><tr><td colspan="2"><small>( Как Вы оцениваете данный материал? По умолчанию оценка не ставится )</small></td></tr><tr><td colspan="2">Введите число, изображённое на картинке <img src="http://dexperix.net/scripts/image.php?id=15" width="90" height="30" align="middle" class="captcha" alt="Image" /> : <input type="text" name="captcha" size="8" maxlength="7" /></td></tr><tr><td colspan="2">Текст комментария:</td></tr><tr><td colspan="2" align="center"><textarea name="text"></textarea><br /><input type="submit" value="Оправить комментарий" /></td></tr></table></form></div><div id="reklama"><!--ADVERT_TEMPLATE--></div></div> </div><div id="topic_left"><div id="line_l"></div><div id="info_left"><h3>Дизайн</h3><ul id="l_info"><li><a href="gradient+blp+ru.html">:: Black Purple</a></li><li><a href="gradient+gray+ru.html">:: Gray Text</a></li><li><a href="gradient+npi+ru.html">:: New Pictures</a></li></ul><h3>Друзья</h3><ul id="l_info"><li><a href="http://coderszone.info" target="_blank">:: CodersZone.Info</a></li></ul><h3>Счётчики</h3><ul id="l_info"><li><!--LiveInternet counter--><script type="text/javascript"><!--
document.write("<a href='http://www.liveinternet.ru/click' "+
"target=_blank><img src='http://counter.yadro.ru/hit?t24.5;r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";"+Math.random()+
"' alt='' title='LiveInternet: showed number of visiters"+
" today' "+
"border=0 width=88 height=15><\/a>")//--></script><!--/LiveInternet--></li><li><!-- MyCounter v.2.0 -->
<script type="text/javascript"><!--
my_id = 3456;
my_width = 69;
my_height = 14;
my_alt = "MyCounter - Ваш счётчик";
//--></script>
<script type="text/javascript"
  src="http://scripts.mycounter.com.ua/counter2.0.js">
  </script><noscript>
<div>  <a href="http://mycounter.com.ua/"><img
  src="http://get.mycounter.com.ua/counter.php?id=3456"
  title="MyCounter - Ваш счётчик"
  alt="MyCounter - Ваш счётчик"
  width="69" height="14" /></a></div></noscript>
</li></ul></div></div></div><div id="paw"></div></div><div id="add_menu"><ul id="menu_right"><li><a href="../alg/index+npi+ru.html" id="algru" title="Алгоритмы"></a></li><li><a href="../linux/index+npi+ru.html" id="linuxru" title="Linux"></a></li><li><a href="../delphi/index+npi+ru.html" id="delphiru" title="Delphi"></a></li><li><a href="../php/index+npi+ru.html" id="phpru" title="PHP кодинг"></a></li><li><a href="../hack/index+npi+ru.html" id="hackru" title="Хакинг"></a></li><li><a href="../track-music/index+npi+ru.html" id="track-musicru" title="Музыка"></a></li><li><a href="../diz/index+npi+ru.html" id="dizru" title="Дизайн"></a></li><li><a href="../instr/index+npi+ru.html" id="instrru" title="Инструкции"></a></li><li><a href="../other/index+npi+ru.html" id="otherru" title="Другие"></a></li></ul></div></div><div id="bottom"><div id="footer"><ul id="f_left"><li class="ukz"></li><li class="copyright">Copyright &copy; <span>2005-2009</span> by  <a href="http://dexperix.net">DeXPeriX</a></li></ul><ul id="f_right"><li class="icq">606 - 986</li><li class="jabber"><a>root<span>@</span>dexp.in</a></li></ul></div></div></body></html>